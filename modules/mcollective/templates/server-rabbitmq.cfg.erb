<%
case @osfamily
when 'windows'
	purootdir = @osfamily
	ssldir = @ssldir
	mcrootdir = @mcrootdir
	mccfgdir = @mccfgdir
	mcssldir = @mcssldir
	libdir = @libdir
	logdir = @logdir
	daemonize = 1
else
	ssldir = @ssldir
	mccfgdir = @mccfgdir
	mcssldir = @mccfgdir
	libdir = @libdir
	logdir = @logdir
	daemonize = 1
end
%>
# RabbitMQ connector settings:
connector = rabbitmq
direct_addressing = 1
plugin.rabbitmq.vhost = /mcollective
plugin.rabbitmq.pool.size = <%= @mqs.count %>
<% @mqs.count.times do |n| -%>
plugin.rabbitmq.pool.<%= n+1 %>.host = <%= @mqs[n]['host'] %>
plugin.rabbitmq.pool.<%= n+1 %>.port = 61613
plugin.rabbitmq.pool.<%= n+1 %>.user = mcollective
plugin.rabbitmq.pool.<%= n+1 %>.password = <%= @mqs[n]['passwd'] %>
<% end %>

# SSL security plugin settings:
securityprovider = psk
plugin.psk =  a36cd839414370e10fd281b8a38a4f48

# Facts, identity, and classes:
identity = <%= @ipaddress %>
factsource = yaml
plugin.yaml = <%= mccfgdir%>/facts.yaml
classesfile = <%= scope['settings::statedir'] %>

# No additional subcollectives:
collectives = mcollective
main_collective = mcollective

rpcaudit = 1
rpcauditprovider = logfile
plugin.rpcaudit.logfile = <%= logdir%>/mcollective-audit.log


# Logging:
logger_type = file
loglevel = info
logfile = <%= logdir%>/mcollective.log
keeplogs = 5
max_log_size = 2097152
logfacility = user


libdir = <%= libdir%>
daemonize = <%= daemonize%>
